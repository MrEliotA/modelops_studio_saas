apiVersion: v1
kind: ConfigMap
metadata:
  name: mlops-compute-profiles
  namespace: mlops-system
data:
  profiles.yaml: |-
    profiles:
      # T4 node with time-slicing enabled via GPU Operator device-plugin config:
      #   kubectl label node <node> nvidia.com/device-plugin.config=tesla-t4 --overwrite
      - name: t4-shared-1x
        kind: full-gpu
        description: "T4 shared (time-slicing) - request 1 logical GPU replica"
        podSpecPatch:
          nodeSelector:
            nvidia.com/device-plugin.config: "tesla-t4"
          tolerations:
            - key: "nvidia.com/gpu"
              operator: "Equal"
              value: "true"
              effect: "NoSchedule"
          containers:
            - name: main
              resources:
                limits:
                  nvidia.com/gpu: "1"

      # A100/A30 node with MIG enabled via GPU Operator device-plugin config:
      #   kubectl label node <node> nvidia.com/device-plugin.config=a100-mixed --overwrite
      - name: a100-mig-1g5gb
        kind: mig
        description: "A100 MIG 1g.5gb"
        podSpecPatch:
          nodeSelector:
            nvidia.com/device-plugin.config: "a100-mixed"
          tolerations:
            - key: "nvidia.com/gpu"
              operator: "Equal"
              value: "true"
              effect: "NoSchedule"
          containers:
            - name: main
              resources:
                limits:
                  nvidia.com/mig-1g.5gb: "1"
